---
title: "Rust ã®é–‹ç™ºç’°å¢ƒãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—"
emoji: "ğŸ¦€"
type: "tech"
topics: ["rust"]
published: false
---

## Rust ã®å°å…¥

Rust å…¬å¼ã® [Getting Started](https://www.rust-lang.org/learn/get-started) ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ [rustup](https://rustup.rs) ã‚’ä½¿ã†ã®ãŒæœ€ã‚‚æ‰‹ã£å–ã‚Šæ—©ãç¢ºå®Ÿã€‚

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

rustup ã‚’å°å…¥ã—ãŸå¾Œã¯ rustup ã‹ã‚‰å°å…¥å¯èƒ½ãª [clippy](https://doc.rust-lang.org/stable/clippy/index.html) ã¨ [rustfmt](https://github.com/rust-lang/rustfmt) ã‚’å…¥ã‚Œã‚‹ã€‚ã“ã‚Œã¯ã‚¨ãƒ‡ã‚£ã‚¿ã®ã¨ã“ã‚ã§è¨­å®šã™ã‚‹ã€‚

```bash
rustup component add clippy
rustup component add rustfmt
```

Rust ã¯é »ç¹ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã‚‹ãŒã€ `update` ã‚³ãƒãƒ³ãƒ‰ã‚’ç™ºè¡Œã™ã‚‹ã“ã¨ã§ stable ç‰ˆã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒã§ãã‚‹ã€‚ã¾ãŸ `update` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ `rustup self update` ã‚‚åŒæ™‚ã«è¡Œã‚ã‚Œã‚‹ãŸã‚ `rustup` ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚‚è‡ªå‹•çš„ã«è¡Œã‚ã‚Œã‚‹ã€‚

```bash
rustup update
```

å¿…é ˆã§ã¯ãªã„ãŒã€[cargo-deny](https://github.com/EmbarkStudios/cargo-deny) ã‚’å…¥ã‚Œã‚‹ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å«ã¾ã‚Œã‚‹ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆã«ã¾ã¤ã‚ã‚‹å„ç¨®ãƒã‚§ãƒƒã‚¯ã‚’è‡ªå‹•çš„ã«è¡Œã£ã¦ãã‚Œã‚‹ã€‚ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆãŒæœ€çµ‚çš„ã«ã¯æ•°ç™¾ã«ã®ã¼ã‚‹ã“ã¨ã¯æ±ºã—ã¦çã—ããªãã€ã“ã‚Œã‚’è‡ªå‹•åŒ–ã§ãã‚‹å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã®ãŸã‚ã§ãã‚Œã°å…¥ã‚ŒãŸã„ã€‚

```bash
cargo install cargo-deny
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ä½œæˆã™ã‚‹å ´åˆã¯ `new` ã‚³ãƒãƒ³ãƒ‰ã‚’ç™ºè¡Œã™ã‚‹ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å ´åˆã¯è¿½åŠ ã§ `--lib` ã‚’ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã“ã®ã¨ã `.gitignore` ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å«ã‚ã¦ git ãƒ¬ãƒã‚¸ãƒˆãƒªãŒè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã‚‹ã€‚

```bash
cargo new [path/to/directory]
```

cargo-deny ã‚’å°å…¥ã—ã¦ã„ã‚‹å ´åˆã¯åˆæœŸåŒ–ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã€‚

```bash
cargo deny init
```

[rust-toolchain.toml](https://rust-lang.github.io/rustup/overrides.html#the-toolchain-file) ã‚’ãƒ¬ãƒã‚¸ãƒˆãƒªã®æœ€ä¸Šä½ã«é…ç½®ã™ã‚‹ã“ã¨ã§ Rust ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ”ãƒ‹ãƒ³ã‚°ã¨å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å°å…¥ã‚’ rustup ãŒè‡ªå‹•çš„ã«å®Ÿæ–½ã—ã¦ãã‚Œã‚‹ã€‚æœ€åˆã®ã¨ã“ã‚ã§ç´¹ä»‹ã—ãŸ `clippy` ã¨ `rustfmt` ã‚’å…¥ã‚Œã‚ˆã†ã€‚

```toml
[toolchain]
components = ["rustfmt", "clippy"]
```

## ã‚¨ãƒ‡ã‚£ã‚¿

ãŠå¥½ã¿ã§è‰¯ã„ãŒã€ã§ãã‚Œã° [rust-analyzer](https://rust-analyzer.github.io) ãŒä½¿ãˆã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ã€ãã®ä¸­ã§ã‚‚æœ€ã‚‚ç›¸æ€§ãŒè‰¯ã„ [Visual Studio Code](https://code.visualstudio.com) ãŒæœ›ã¾ã—ã„ã€‚ã“ã“ã§ã¯ä¸¡æ–¹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã“ã¨ã‚’å‰æã§è©±ã‚’é€²ã‚ã‚‹ã€‚

### Visual Studio ã®è¨­å®š

[Visual Studio ã«ãŠã‘ã‚‹ Rust ã®è§£èª¬è¨˜äº‹](https://code.visualstudio.com/docs/languages/rust)

#### æ‹¡å¼µæ©Ÿèƒ½

rust-analyzer ä»¥å¤–ã«ä»¥ä¸‹ã®ãµãŸã¤ã‚’å°å…¥ã™ã‚‹ã€‚ãŸã ã— CodeLLDB ã¯ Windows ã§ã¯å‹•ä½œãŒã¨ã¦ã‚‚é‡ã„ãŸã‚ C/C++ ã‚’å«ã‚€å ´åˆã¯ [Native Debug](https://marketplace.visualstudio.com/items?itemName=webfreak.debug) ã‚’ä»£æ›¿ã¨ã—ã¦ä½¿ã£ãŸæ–¹ãŒè‰¯ã„å ´åˆãŒã‚ã‚‹ã€‚

* [CodeLLDB](https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb)
* [Even Better TOML](https://marketplace.visualstudio.com/items?itemName=tamasfe.even-better-toml)

#### `Editor: Format On Paste` (`editor.formatOnPaste`)

ã‚³ãƒ¼ãƒ‰ã‚’ãƒšãƒ¼ã‚¹ãƒˆã™ã‚‹æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¡Œã†ã‹ã©ã†ã‹ã®è¨­å®šã€‚ `rustfmt` ãŒä½¿ã‚ã‚Œã‚‹ã®ã§åŸå‰‡ã¨ã—ã¦ãƒã‚§ãƒƒã‚¯ã‚’ã„ã‚Œã‚‹ã€‚

#### `Editor: Format On Save` (`editor.formatOnSave`)

ãƒšãƒ¼ã‚¹ãƒˆã¨åŒã˜ã‚ˆã†ã«ãƒã‚§ãƒƒã‚¯ã‚’ã„ã‚Œã‚‹ã€‚ã“ã‚Œã§ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ™‚ã«è‡ªå‹•çš„ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒã‹ã‹ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

#### `Exclude` (`files.exclude`)

`Add Pattern` ã§ `**/target` ã‚’è¿½åŠ ã™ã‚‹ã€‚`target` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ãƒ“ãƒ«ãƒ‰å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹ãŒã€ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã—ã¦ç›´æ¥å‚ç…§ã™ã‚‹æ©Ÿä¼šã¯åŸºæœ¬çš„ã«ãªã„ã®ã§é™¤å¤–å¯¾è±¡ã«ã™ã‚‹ã€‚

#### `Rust-analyzer > Check` (`rust-analyzer.check.command`)

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ `check` ã ãŒã“ã‚Œã‚’ `clippy` ã«å·®ã—æ›¿ãˆã‚‹ã“ã¨ã§ã‚ˆã‚Šå¤šãã®ãƒã‚§ãƒƒã‚¯ãŒå¯èƒ½ã«ãªã‚‹ã€‚åŠ ãˆã¦ clippy ãŒææ¡ˆã™ã‚‹æ›¸ãæ–¹ã¸ã®ä¿®æ­£ã‚‚ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

```
clippy
```

## ã‚ˆãä½¿ã†å®šç•ªã‚¯ãƒ¬ãƒ¼ãƒˆ

ï¼ˆä¸»ã«è‡ªåˆ†ãŒï¼‰ã‚ˆãä½¿ã†å¿…é ˆç´šã®å®šç•ªã‚¯ãƒ¬ãƒ¼ãƒˆã‚’è¨˜è¼‰ã™ã‚‹ã€‚

* [anyhow](https://docs.rs/anyhow/latest/anyhow/)
  * `Result` å‹ã‚’ç°¡æ½”ã«ã§ãã‚‹ãŠãã‚‰ãæœ€ã‚‚ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¯ãƒ¬ãƒ¼ãƒˆ
  * `anyhow` ã®æœ‰ç„¡ã§ã‚³ãƒ¼ãƒ‰ã®æ›¸ãæ–¹ãŒå¤§ããå¤‰ã‚ã‚‹ã¨ã„ã£ã¦ã‚‚éè¨€ã§ã¯ãªã„ã»ã©
  * å¤–ã ã—ã—ãªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã“ã‚Œã²ã¨ã¤ã§å•é¡Œãªã„ãŒã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦å…¬é–‹ã™ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼åˆ¤å®šãŒã§ããªããªã‚‹ã®ã§ `thiserror` ã‚’ä½¿ãŠã†
    * ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦å…¬é–‹ã™ã‚‹å ´åˆåˆæœŸæ®µéšã§ `anyhow` ã‚’ä½¿ã†åˆ†ã«ã‚ˆã„ã«ã—ã¦ã‚‚æ—©ã„æ®µéšã§ `thiserror` ã«åˆ‡ã‚Šæ›¿ãˆãªã„ã¨æ”¹ä¿®ãŒå¤§å¤‰ã«ãªã‚‹
* [thiserror](https://docs.rs/thiserror/latest/thiserror/)
  * `Error` å‹ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ´¾ç”Ÿãƒã‚¯ãƒ­ã¨ã—ã¦è¡¨ç¾ã™ã‚‹ã“ã¨ã§å®Ÿè£…ã‚’ç°¡ç´ åŒ–ã§ãã‚‹ã‚¯ãƒ¬ãƒ¼ãƒˆ
  * `anyhow` ã®ç®‡æ‰€ã§æ›¸ã„ãŸé€šã‚Šã€ä¸»ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå´ã§ä½¿ã†
* [tracing](https://docs.rs/tracing/latest/tracing/)
  * æ§‹é€ åŒ–ãƒ­ã‚®ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¯ãƒ¬ãƒ¼ãƒˆã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå‘ã‘ã«åˆ©ç”¨
    * æ§‹é€ åŒ–ã‚’ä½¿ç”¨ã—ãªã„ãªã‚‰ [log](https://docs.rs/log/latest/log/) ã‚¯ãƒ¬ãƒ¼ãƒˆã§è¦ä»¶ã‚’æº€ãŸã›ã‚‹
    * ãŸã ã— `tracing` ã‚¯ãƒ¬ãƒ¼ãƒˆã«æ®µéšçš„ã«å¤‰æ›´ã—ãŸã„å ´åˆã¯ [tracing-log](https://docs.rs/tracing-log/latest/tracing_log/) ã®é¸æŠè‚¢ãŒã‚ã‚‹
  * tokio é–¢é€£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã ãŒå˜ç‹¬ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦åˆ©ç”¨å¯èƒ½
* [tracing_subscriber](https://docs.rs/tracing-subscriber/latest/tracing_subscriber/)
  * `tracing` ã‚¯ãƒ¬ãƒ¼ãƒˆãŒè¨˜éŒ²ã—ãŸå‡¦ç†ã‚’å‡ºåŠ›ã™ã‚‹ã‚¯ãƒ¬ãƒ¼ãƒˆã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‘ã‘ã«åˆ©ç”¨
  * `tracing` ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ `log` ã‚¯ãƒ¬ãƒ¼ãƒˆã«ç›¸å½“ã™ã‚‹ãªã‚‰ã“ã¡ã‚‰ã¯ [env_logger](https://docs.rs/env_logger/latest/env_logger/) ã«ç›¸å½“ã™ã‚‹
* [serde](https://docs.rs/serde/latest/serde/)
  * ãƒ‡ãƒ¼ã‚¿ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãŠã‚ˆã³ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚’ç›®çš„ã¨ã—ãŸã‚¯ãƒ¬ãƒ¼ãƒˆ
  * ä¸»ã« JSON å®Ÿè£…ã§ã‚ã‚‹ [serde_json](https://docs.rs/serde_json/latest/serde_json/) ã‚’ [serde_derive](https://serde.rs/derive.html) ã¨çµ„ã¿åˆã‚ã›ã‚‹å½¢ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒå¤šã„

## GitHub Actions

[Dependabot](https://docs.github.com/ja/code-security/dependabot) ã‚’ã¾ãšå…¥ã‚Œã‚‹ã“ã¨ã€‚é »ç¹ã«ã‚¯ãƒ¬ãƒ¼ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã€å°‘ãªãã¨ã‚‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒã‚ã£ãŸã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ä½œæ¥­ã¯ Dependabot ã«ä»»ã›ã‚ˆã†ã€‚

æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `.github/dependabot.yml` ã‚’ä½œæˆã—ã¦ main ãƒ–ãƒ©ãƒ³ãƒã«å–ã‚Šè¾¼ã‚€ã“ã¨ã§è‡ªå‹•çš„ã«ç™ºå‹•ã™ã‚‹ã€‚è¨­å®šã«ã¤ã„ã¦ã®è©³ç´°ã¯ [dependabot.yml ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³](https://docs.github.com/ja/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file) ã‚’å‚ç…§ã€‚

```yaml
version: 2
updates:
  - package-ecosystem: "cargo"
    directory: "/"
    schedule:
      interval: "weekly"
```

ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã«ãŠã„ã¦ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸ŠãŒã£ãŸå ´åˆã¯ Dependabot ãŒä½œæˆã—ãŸãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è‡ªå‹•çš„ã«ãƒãƒ¼ã‚¸ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚ã“ã‚Œã¯ [GitHub ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ–¹æ³•ãŒè§£èª¬ã•ã‚Œã¦ã„ã‚‹](https://docs.github.com/ja/code-security/dependabot/working-with-dependabot/automating-dependabot-with-github-actions#enable-auto-merge-on-a-pull-request) ã®ã§ãã‚Œã‚’å‚è€ƒã«ã™ã‚‹ã€‚ãªãŠãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ¬ãƒã‚¸ãƒˆãƒªã ã‘ã§ãªããƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒªã§ã‚‚åŒæ§˜ã«ã§ãã‚‹ã€‚

æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `.github/workflows/dependabot-auto-merge.yml` ã‚’ä½œæˆã—ã¦ main ãƒ–ãƒ©ãƒ³ãƒã«å–ã‚Šè¾¼ã‚€ã“ã¨ã§æœ‰åŠ¹ã«ãªã‚‹ã€‚ `.github/workflows` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚Œã¦ã„ã‚Œã°ãƒ•ã‚¡ã‚¤ãƒ«åã«ã¤ã„ã¦ã¯ä»»æ„ã€‚

```yaml
name: Dependabot auto-merge
on: pull_request

# æ›¸ãè¾¼ã¿ãŒç™ºç”Ÿã™ã‚‹ãŸã‚å¿…è¦ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’æ˜ç¤ºçš„ã«è¨­å®šã™ã‚‹
permissions:
  contents: write
  pull-requests: write

jobs:
  dependabot:
    runs-on: ubuntu-latest
    if: ${{ github.actor == 'dependabot[bot]' }}
    steps:
      # ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‹ã‚‰åˆ¤å®šã‚’è¡Œã†ãŸã‚å¿…è¦ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹
      - name: Dependabot metadata
        id: metadata
        uses: dependabot/fetch-metadata@v1
        with:
          github-token: "${{ secrets.GITHUB_TOKEN }}"
      # ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ›´æ–°ãªã‚‰ãƒãƒ¼ã‚¸ã‚’è¡Œã†
      #ï¼ˆå…¬å¼ã§ã¯ Merge Commit ã ãŒã“ã“ã§ã¯ Squash Merge ã‚’è¡Œã£ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ï¼‰
      - name: Enable auto-merge for Dependabot PRs
        if: ${{ steps.metadata.outputs.update-type == 'version-update:semver-patch' }}
        run: gh pr merge --auto --squash "$PR_URL"
        env:
          PR_URL: ${{ github.event.pull_request.html_url }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

Rust ã® GitHub Actions å‘ã‘ã®ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯å…¬å¼ã«æä¾›ã—ã¦ã„ã‚‹ã‚‚ã®ã¯ãªã„ãŒã€æœ‰åŠ›ãªé¸æŠè‚¢ã¨ã—ã¦ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è‡ªå‹•çš„ã«æ§‹ç¯‰ã—ã¦ãã‚Œã‚‹ `actions-rust-lang/setup-rust-toolchain@v1` ãŒã‚ã‚‹ã€‚

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: setup rust toolchain
        uses: actions-rust-lang/setup-rust-toolchain@v1
      - run: cargo test --all --no-default-features
```
